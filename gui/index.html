<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>I am a Mug</title>
    <link rel="stylesheet" type="text/css" href="jquery.fullPage.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="jquery.fullPage.js"></script>
</head>
<body>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#fullpage').fullpage({
                sectionsColor: ['#1bbc9b', '#4BBFC3', '#7BAABE', 'whitesmoke', '#ccddff'],
                scrollingSpeed: 1000
            });
        });
    </script>
    <script>
        //Node Dependencies
        var net = require('net');
        var client = new net.Socket();
        //create eventEmitter and gesture_recognizer objects.
        var gesture = require("./node_modules/gesture.js")
        var EventEmitter = require("events").EventEmitter;
        var searchTerm = 'parrot'
        //Potentiometer 1
        var ee = new EventEmitter();
        var gesture_recognizer = new gesture(1, 0, '4096', '860')
        //Event handler functions

        var searchTerm = "";
        // Get the API key from Google's developer console
        // Get the CSE ID from google.com/cse

        ee.on("swipe-up,0", function (data) {
            console.log("0:swipe_up gesture is called, velocity:" + data);
            $.fn.fullpage.moveSlideRight();
        });

        ee.on("swipe-down,0", function (data) {
            console.log("0:swipe_down gesture is called, velocity:" + data);
            $.fn.fullpage.moveSlideLeft();
        });

        ee.on("click-event,0", function (data) {
            console.log("0:click detected at point:" + data);
            client.connect(10000, '127.0.0.1', function () {
                console.log('Connected');
                client.write('Start');
            });
            client.on('data', function (data) {
                console.log('Received: ' + data);
                searchTerm = data.toString();
                var KEY = 'AIzaSyDoTp6UicPtIH_JVy-cFwoebTEp9-rRHYE';
                var CX = '007548910499588559159:lepkrgs8oig';
                var count = '5';
                var format = 'json';
                var startIndex = '1';
                var url = "https://www.googleapis.com/customsearch/v1?q=" + searchTerm + "&num=" + count + "&start=" + startIndex + "&key=" + KEY + "&cx=" + CX + "&searchType=image";
                var texturl = "https://en.wikipedia.org/w/api.php?format=" + format + "&action=query&prop=extracts&exintro=&explaintext=&titles=" + searchTerm;
                //var obj = JSON.parse(api);
                //console.log(obj.items.link)
                console.log("Url of image search: " + url)
                console.log("Url of text search: " + texturl)

                // ----receive function----v

                $.getJSON(url, function (data) {
                    console.log(data)
                    for (var i = 0; i < 5; i++) {
                        console.log(data.items[i].link)
                    }
                    document.getElementById("img0").src = data.items[0].link;
                    document.getElementById("img1").src = data.items[1].link;
                    document.getElementById("img2").src = data.items[2].link;
                    document.getElementById("img3").src = data.items[3].link;
                    document.getElementById("img4").src = data.items[4].link;
                });

                var dbpediaurl = "http://lookup.dbpedia.org/api/search.asmx/KeywordSearch?QueryString=" + searchTerm + "&MaxHits=1";
                console.log("Url of dbpedia search: " + dbpediaurl)

                $(function () {
                    $.ajax({
                        type: "get",
                        url: dbpediaurl,
                        dataType: "xml",
                        success: function (data) {
                            $(data).find('ArrayOfResult').each(function () {
                                $(this).find("Result").each(function () {
                                    $(this).find("Description").each(function () {
                                        var description = $(this).text();
                                        document.getElementById("info0").innerHTML = description
                                    });
                                });
                            });
                        },
                        error: function (xhr, status) {
                            /* handle error here */
                            $("#show_table").html(status);
                        }
                    });
                });
                client.destroy(); // kill client after server's response
            });

            client.on('close', function () {
                console.log('Connection closed');
            });
        });

        //Second potentiometer
        ee.on("swipe-up,1", function (data) {
            console.log("1:swipe_up gesture is called, velocity:" + data);
            $.fn.fullpage.moveSectionUp();
        });

        ee.on("swipe-down,1", function (data) {
            console.log("1:swipe_down gesture is called, velocity:" + data);
            $.fn.fullpage.moveSectionDown();
        });

        ee.on("click-event,1", function (data) {
            console.log("1:click detected at point:" + data);
            var KEY = 'AIzaSyDoTp6UicPtIH_JVy-cFwoebTEp9-rRHYE';
            var CX = '007548910499588559159:lepkrgs8oig';
            var count = '5';
            var format = 'json';
            var startIndex = '1';
            var url = "https://www.googleapis.com/customsearch/v1?q=" + searchTerm + "&num=" + count + "&start=" + startIndex + "&key=" + KEY + "&cx=" + CX + "&searchType=image";
            var texturl = "https://en.wikipedia.org/w/api.php?format=" + format + "&action=query&prop=extracts&exintro=&explaintext=&titles=" + searchTerm;
            //var obj = JSON.parse(api);
            //console.log(obj.items.link)
            console.log("Url of image search: " + url)
            console.log("Url of text search: " + texturl)

            // ----receive function----v

            $.getJSON(url, function (data) {
                console.log(data)
                for (var i = 0; i < 5; i++) {
                    console.log(data.items[i].link)
                }
                document.getElementById("img01").src = data.items[0].link;
                document.getElementById("img11").src = data.items[1].link;
                document.getElementById("img21").src = data.items[2].link;
                document.getElementById("img31").src = data.items[3].link;
                document.getElementById("img41").src = data.items[4].link;
            });

            var dbpediaurl = "http://lookup.dbpedia.org/api/search.asmx/KeywordSearch?QueryString=" + searchTerm + "&MaxHits=1";
            console.log("Url of dbpedia search: " + dbpediaurl)

            $(function () {
                $.ajax({
                    type: "get",
                    url: dbpediaurl,
                    dataType: "xml",
                    success: function (data) {
                        $(data).find('ArrayOfResult').each(function () {
                            $(this).find("Result").each(function () {
                                $(this).find("Description").each(function () {
                                    var description = $(this).text();
                                    document.getElementById("info1").innerHTML = description
                                });
                            });
                        });
                    },
                    error: function (xhr, status) {
                        /* handle error here */
                        $("#show_table").html(status);
                    }
                });
            });
        });

        gesture_recognizer.startMultiChannelReading(ee,[0,1]);

    </script>

    <div id="fullpage">

        <div class="section active" id="section0">
            <div class="slide">
                <div class="intro" id="info0">
                    <p>Hello</p>
                </div>

            </div>
            <div class="slide">
                <div class="intro">
                    <img id="img0" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img id="img1" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img id="img2" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img id="img3" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img id="img4" src="1.png" />
                </div>
            </div>
        </div>

        <div class="section" id="section1">
            <div class="slide">
                <div class="intro" id="info1">
                    <p>Hello</p>
                </div>

            </div>
            <div class="slide">
                <div class="intro">
                    <img id="img01" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img id="img11" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img id="img21" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img id="img31" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img id="img41" src="1.png" />
                </div>
            </div>
        </div>
    </div>

</body>
</html>