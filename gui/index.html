<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=240, initial-scale=1">
    <title>I am a Mug</title>
    <link rel="stylesheet" type="text/css" href="jquery.fullPage.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="jquery.fullPage.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style type="text/css">
        ::-webkit-scrollbar {
            display: none;
        }

        div#WikiData0 {
            text-align: center;
        }

        div#WikiData1 {
            text-align: center;
        }

        div#header0 {
            height: 28px;
            background: rgba(128, 128, 128, 0.6);
            width: 100%;
            margin: 0px auto;
            text-align: center;
        }

        p{
            display: block;
            --webkit-margin-before: 1em;
            --webkit-margin-before: 1em;
            --webkit-margin-before: 0px;
            --webkit-margin-before: 0px;
        }

        p#articleBody0 {
            color: white;
            width: 200px;
            height: 250px;
            text-align: justify;
            margin: auto;

        }

        p#desc0 {
            color: #FFF;
            font-weight: bold;
        }

        p#info0 {
            color: #FFF;
            vertical-align: middle;
            font-weight: bold;
            font-style: bold;
            font-family: "Verdana";
        }

        img {
            width: 80%;
            padding-top: 0;
            display: block;
            margin-top: 0;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%;
            max-height: 90%;
        }
    </style>
</head>
<body>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#fullpage').fullpage({
                sectionsColor: ['#000'],
                paddingBottom: '20px',
                controlArrows: false,
                loopHorizontal: false,
                autoScrolling: false,
                scrollBar: false,
                responsiveWidth: 400,
                scrollingSpeed: 500
            });
        });
    </script>
    <script>
        'use strict'
        var ee = require('electron').ipcRenderer;
        var remote = require('electron').remote;
        var https = require('https')
        var net = require('net');
        var client = new net.Socket();
        var event_emitter = require('events').EventEmitter;
        var kg_ee = new event_emitter();
        var search = require("./web_search.js")
        var countClick = 0;
        var countSlideLeft = 0;
        var countSlideRight = 0;
        var countMoveSectionUp = 0;
        var countMoveSectionDown = 0;

        var section_count = 0;
        var dataLength = 0;
        var count = '5';
        var format = 'xml';
        var startIndex = '1';
        var onprocess = false;
        var debug = false;
        var searchTerm = "";
        var idCount = 0;
        var KEY = 'AIzaSyDoTp6UicPtIH_JVy-cFwoebTEp9-rRHYE';
        var CX = '007548910499588559159:lepkrgs8oig';
        var api_host = 'kgsearch.googleapis.com';
        var api_key = 'AIzaSyDoTp6UicPtIH_JVy-cFwoebTEp9-rRHYE';
        var resultStorage = [];
        var imageArray = [];

        var fs = require('fs');
        var util = require('util');
        var log_file = fs.createWriteStream(__dirname + '/debug.log', { flags: 'w' });
        var log_stdout = process.stdout;



	var my_console_log = function (d) { //
            if (util != null && debug) {
                log_file.write(util.format(d) + '\n');
                log_stdout.write(util.format(d) + '\n');
            } else {
                console.log(d);
            }
        };

        ee.on("swipe-down,1", function (data) {
            countSlideRight++;
            my_console_log("1: slide right gesture is called");
            $.fn.fullpage.moveSlideRight();
        });

        ee.on("swipe-up,2", function (data) {
            countSlideRight++;
            my_console_log("2: slide right gesture is called");
            $.fn.fullpage.moveSlideRight();
        });

        ee.on("swipe-up,1", function (data) {
            countSlideLeft++;
            my_console_log("1: slide left gesture is called");
            $.fn.fullpage.moveSlideLeft();
        });

        ee.on("swipe-down,2", function (data) {
            countSlideLeft++;
            my_console_log("2: slide left gesture is called");
            $.fn.fullpage.moveSlideLeft();
        });


        var handle_section_changes = function(direction){
            if(!direction){
                section_count++;
                countMoveSectionDown++;
            }else{
                section_count--;
                countMoveSectionUp++
            }

            if (resultStorage.length <= section_count || imageArray.length <= section_count ) {
                section_count--;
            }else if(section_count < 0){
                section_count++
            } else {
                var name = resultStorage[section_count]['name'] || resultStorage[section_count]['description'];
                document.getElementById("info0").innerHTML = name;
                var description = resultStorage[section_count]['description'] || resultStorage[section_count]['detailedDescription']['articleBody'];

                document.getElementById("desc0").innerHTML = description;
                document.getElementById("WikiData0").innerHTML = resultStorage[section_count]['detailedDescription']['articleBody'];

                document.getElementById("img0").src = imageArray[section_count][0];
                document.getElementById("img1").src = imageArray[section_count][1];
                document.getElementById("img2").src = imageArray[section_count][2];
                document.getElementById("img3").src = imageArray[section_count][3];
                document.getElementById("img4").src = imageArray[section_count][4];
            }
            var log_direction  = direction ? 'moveSectionUp':'moveSectionDown';
            my_console_log("After" + log_direction +" section_count is: " + section_count)
        }

        ee.on("swipe-down,0", function (data) {

          handle_section_changes(false);
        });

        ee.on("swipe-up,0", function (data) {
            handle_section_changes(true)
        });


        ee.on("click-event,2", function (data) {
            my_console_log("2:click detected at point:" + data);
            countClick++;
            if (!onprocess) {
                onprocess = true;
                document.getElementById("desc0").innerHTML = "ARIYORUM";

                client.connect(10000, 'localhost', function () {
                    my_console_log('Connected');
                    client.write('Start');
                });

                client.on('close', function () {
                    my_console_log('Connection closed');
                    onprocess = false
                });

                client.on('data', function (data) {
                    my_console_log('Data received from stt: ' + data);
                    searchTerm = data.toString();

                    var test_input = searchTerm;
                    my_console_log('SearchTerm from microphone:' + test_input);
                    //var texturlTR = "https://tr.wikipedia.org/w/api.php?format=" + format + "&action=query&prop=extracts&exintro=&explaintext=&titles=" + searchTerm;
                    //my_console_log(texturlTR)
                    //var yandexTanslateURL = "https://translate.yandex.net/api/v1.5/tr.json/translate?key=trnsl.1.1.20161109T203752Z.31a66f7b078518f9.4cfb304a7f2d5dadbb4aa80ac4261c70258e5816&text=" + searchTerm + "&lang=tr-en&format=json"
                    // my_console_log(yandexTanslateURL)
                    // ----receive function----v



                  if(test_input != ''){
                    search.starter(test_input,debug, kg_ee)
                    var received_result_no = 0;
                  }else{
                    kg_ee.emit('error_occurs', "NothingFound");
                  }

                  kg_ee.on("result", function (data) {

                    data.name = data.name || data.description;
                    data.description = data.description || "";
			              data.detailedDescription.articleBody = data.detailedDescription.articleBody || "";

			               if(received_result_no == 0){
                            section_count = 0;
                            resultStorage.length = 0;
                            imageArray.length = 0;
                            resultStorage.push(data);

                            document.getElementById("info0").innerHTML = data.name;
                            document.getElementById("desc0").innerHTML = data.description;
                            document.getElementById("WikiData0").innerHTML = data.detailedDescription.articleBody;

                            var url = "https://www.googleapis.com/customsearch/v1?q=" + name + "&num=" + count + "&start=" + startIndex + "&key=" + KEY + "&cx=" + CX + "&searchType=image";

                            $.getJSON(url, function (image_data) {
                                imageArray.push(image_data.items.map(function (item) { return item.link; }));
                                document.getElementById("img0").src = image_data.items[0].link;
                                document.getElementById("img1").src = image_data.items[1].link;
                                document.getElementById("img2").src = image_data.items[2].link;
                                document.getElementById("img3").src = image_data.items[3].link;
                                document.getElementById("img4").src = image_data.items[4].link;
                            });
                     }else{
                              resultStorage.push(data);
                              var url = "https://www.googleapis.com/customsearch/v1?q=" + name + "&num=" + count + "&start=" + startIndex + "&key=" + KEY + "&cx=" + CX + "&searchType=image";

                            //  $.getJSON(url, function (image_data) {
                            //      imageArray.push(image_data.items.map(function (item) { return item.link; }));
                            //  });


			                    }
                        received_result_no++;
                    });

                    kg_ee.on('error_occurs', function(data){
                        document.getElementById("info0").innerHTML = "Nothing Here";
                        document.getElementById("desc0").innerHTML = "I couldn't find anytihng";
                        document.getElementById("WikiData0").innerHTML = "I am sorry :(";
                        document.getElementById("img0").src = "travolta.gif";
                        document.getElementById("img1").src = "travolta.gif";
                        document.getElementById("img2").src = "travolta.gif";
                        document.getElementById("img3").src = "travolta.gif";
                        document.getElementById("img4").src = "travolta.gif";
                    });

            		    kg_ee.on("finish", function (data) {
                    		console.log('finish comesssssssssssssssss');
            		    });

                    client.destroy(); // kill client after server's response
                });
            }

        });

    </script>

    <div id="fullpage">

        <div class="section active" id="section0">
            <div id="header0"><p id="info0">Hello</p><p id="desc0">Hello</p></div>

            <div class="slide">
                <div class="intro" id="WikiData0">
                    <p>Hello</p>
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img0" src="1.jpg" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img1" src="1.jpg" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img2" src="1.jpg" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img3" src="1.jpg" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img4" src="1.jpg" />
                </div>
            </div>
        </div>
    </div>

</body>
</html>
