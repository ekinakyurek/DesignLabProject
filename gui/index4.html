<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=240, initial-scale=1">
    <title>I am a Mug</title>
    <link rel="stylesheet" type="text/css" href="jquery.fullPage.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="jquery.fullPage.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>
<body>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#fullpage').fullpage({
                sectionsColor: ['#1bbc9b', '#4BBFC3', '#7BAABE', 'whitesmoke', '#ccddff'],
                scrollingSpeed: 100
            });
        });
    </script>
    <script>
        'use strict'
        //Node Dependencies
        var net = require('net');
        var client = new net.Socket();
        //create eventEmitter and gesture_recognizer objects.
        var gesture = require("./node_modules/gesture.js")
        var EventEmitter = require("events").EventEmitter;
        var searchTerm = 'parrot'
        //Potentiometer 1
        var ee = new EventEmitter();
        var gesture_recognizer = new gesture(1, 0, '4096', '860')
        //Event handler functions
        var yandexTanslateURL = "https://translate.yandex.net/api/v1.5/tr.json/translate?key=trnsl.1.1.20161109T203752Z.31a66f7b078518f9.4cfb304a7f2d5dadbb4aa80ac4261c70258e5816&text="+searchTerm+"&lang=tr-en&format=json"
        var onprocess = true;
        var searchTerm = "";
        var countClick = 0;
        var countSlideLeft = 0;
        var countSlideRight = 0;
        var countMoveSectionUp = 0;
        var countMoveSectionDown = 0;
        // Get the API key from Google's developer console
        // Get the CSE ID from google.com/cse
        var KEY = 'AIzaSyDoTp6UicPtIH_JVy-cFwoebTEp9-rRHYE';
        var CX = '007548910499588559159:lepkrgs8oig';
        var count = '5';
        var format = 'xml';
        var startIndex = '1';

        ee.on("swipe-up,0", function (data) {
            countSlideRight++;
            console.log("0:swipe_up gesture is called, velocity:" + data);
          //  $.fn.fullpage.moveSlideRight();
        });

        ee.on("swipe-down,0", function (data) {
            countSlideLeft++;
            console.log("0:swipe_down gesture is called, velocity:" + data);
          //  $.fn.fullpage.moveSlideLeft();
        });
        
            ee.on("click-event,0", function (data) {
                countClick++;
                console.log("0:click detected at point:" + data);
		        if (onprocess) {
                    client.connect(10000, '127.0.0.1', function () {
                        console.log('Connected');
                        client.write('Start');
                        onprocess = false;
            	    });
                client.on('data', function (data) {
                    onprocess = false;
                    console.log('Received: ' + data);
                    searchTerm = data.toString();
                    var url = "https://www.googleapis.com/customsearch/v1?q=" + searchTerm + "&num=" + count + "&start=" + startIndex + "&key=" + KEY + "&cx=" + CX + "&searchType=image";
                    var texturlTR = "https://tr.wikipedia.org/w/api.php?format=" + format + "&action=query&prop=extracts&exintro=&explaintext=&titles=" + searchTerm;
                    console.log(texturlTR)
                    var yandexTanslateURL = "https://translate.yandex.net/api/v1.5/tr.json/translate?key=trnsl.1.1.20161109T203752Z.31a66f7b078518f9.4cfb304a7f2d5dadbb4aa80ac4261c70258e5816&text="+searchTerm+"&lang=tr-en&format=json"
                    console.log(yandexTanslateURL)
                // ----receive function----v

                $.getJSON(url, function (data) {
                    console.log(data)
                    for (var i = 0; i < 5; i++) {
                        console.log(data.items[i].link)
                    }
                    document.getElementById("img0").src = data.items[0].link;
                    document.getElementById("img1").src = data.items[1].link;
                    document.getElementById("img2").src = data.items[2].link;
                    document.getElementById("img3").src = data.items[3].link;
                    document.getElementById("img4").src = data.items[4].link;
                });

                 $(function () {
                    $.ajax({
                        type: "get",
                        url: texturlTR,
                        dataType: "xml",
                        success: function (data) {
                            console.log(data)
                            $(data).find('api').each(function () {
                                $(this).find("query").each(function () {
                                    $(this).find("pages").each(function () {
                                        $(this).find("page").each(function () {
                                            if($(this).find("missing")){
                                                    getWikiEN();
                                            } else {
                                                $(this).find("extract").each(function () {
                                                    var description = $(this).text();
                                                    document.getElementById("info0").innerHTML = description
                                                    console.log(description)
                                                });
                                            }
                                        });
                                    });
                                });
                            });
                        },
                        error: function (xhr, status) {
                            /* handle error here */
                            $("#show_table").html(status);
                        }
                    });
                });
                function getWikiEN() {
                    $.getJSON(yandexTanslateURL, function (data) {
                    console.log(data)
                        var translation = data.text[0];
                        var texturlEN = "https://en.wikipedia.org/w/api.php?format=" + format + "&action=query&prop=extracts&exintro=&explaintext=&titles=" + translation;
                        $.ajax({
                        type: "get",
                        url: texturlEN,
                        dataType: "xml",
                        success: function (data) {
                            $(data).find('api').each(function () {
                                $(this).find("query").each(function () {
                                    $(this).find("pages").each(function () {
                                        $(this).find("page").each(function () {
                                            $(this).find("extract").each(function () {
                                                var description = $(this).text();
                                                document.getElementById("info0").innerHTML = description
                                            });
                                        });
                                    });
                                });
                            });
                        },
                        error: function (xhr, status) {
                            /* handle error here */
                            $("#show_table").html(status);
                        }
                        });
                    });
                    
                }

                client.destroy(); // kill client after server's response
            });
		}
                client.on('close', function () {
                    console.log('Connection closed');
                    onprocess = true
                });
            });
            
        //Second potentiometer
        ee.on("swipe-up,1", function (data) {
            countMoveSectionUp++;
            console.log("1:swipe_up gesture is called, velocity:" + data);
            //$.fn.fullpage.moveSectionUp();
        });

        ee.on("swipe-down,1", function (data) {
            countMoveSectionDown++;
            console.log("1:swipe_down gesture is called, velocity:" + data);
            //$.fn.fullpage.moveSectionDown();
        });

        ee.on("click-event,1", function (data) {
            countClick++;
            console.log("1:click detected at point:" + data);
        });

        gesture_recognizer.startMultiChannelReading(ee,[0,1]);

    </script>
    <div id="fullpage">

        <div class="section active" id="section0">
            <div class="slide">
                <div class="intro" id="info0">
                    <p>Hello</p>
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img0" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img1" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img2" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img3" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img4" src="1.png" />
                </div>
            </div>
        </div>

        <div class="section" id="section1">
            <div class="slide">
                <div class="intro" id="info1">
                    <p>Hello</p>
                </div>

            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img01" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img11" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img21" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img31" src="1.png" />
                </div>
            </div>
            <div class="slide">
                <div class="intro">
                    <img class="img-responsive" id="img41" src="1.png" />
                </div>
            </div>
        </div>
    </div>


</body>
</html>
